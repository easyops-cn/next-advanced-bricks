// Jest Snapshot v1, https://jestjs.io/docs/snapshot-testing

exports[`parseTsx should work 1`] = `
{
  "components": [
    {
      "children": [
        {
          "children": [
            {
              "children": undefined,
              "componentId": undefined,
              "events": {
                "search": [
                  {
                    "action": "conditional",
                    "payload": {
                      "alternate": [
                        {
                          "action": "update_variable",
                          "payload": {
                            "name": "logId",
                            "value": undefined,
                          },
                        },
                        {
                          "action": "update_query",
                          "payload": {
                            "args": [
                              {
                                "logId": null,
                              },
                              {
                                "notify": false,
                              },
                            ],
                            "method": "push",
                          },
                        },
                      ],
                      "consequent": [
                        {
                          "action": "update_variable",
                          "payload": {
                            "name": "logId",
                            "value": "<% EVENT.detail %>",
                          },
                        },
                        {
                          "action": "update_query",
                          "payload": {
                            "args": [
                              {
                                "logId": "<% EVENT.detail %>",
                              },
                              {
                                "notify": false,
                              },
                            ],
                            "method": "push",
                          },
                        },
                      ],
                      "test": "<% EVENT.detail %>",
                    },
                  },
                ],
              },
              "name": "Search",
              "properties": {
                "inputStyle": {
                  "width": "300px",
                },
                "placeholder": "输入任务 ID 并按回车",
                "value": "<%= CTX.logId %>",
              },
              "ref": undefined,
            },
            {
              "children": [
                {
                  "children": [
                    {
                      "name": "Plaintext",
                      "properties": {
                        "textContent": "<%= CTX.allExpanded ? "全部收起" : "全部展开" %>",
                      },
                    },
                  ],
                  "componentId": undefined,
                  "events": {
                    "click": [
                      {
                        "action": "update_variable",
                        "payload": {
                          "name": "allExpanded",
                          "value": "<% !CTX.allExpanded %>",
                        },
                      },
                    ],
                  },
                  "name": "Button",
                  "properties": {},
                  "ref": undefined,
                },
              ],
              "name": "If",
              "properties": {
                "dataSource": "<%= CTX.logs %>",
              },
            },
          ],
          "componentId": undefined,
          "events": undefined,
          "name": "Toolbar",
          "properties": {},
          "ref": undefined,
        },
        {
          "children": [
            {
              "children": undefined,
              "componentId": undefined,
              "events": undefined,
              "name": "Table",
              "properties": {
                "columns": [
                  {
                    "dataIndex": "time",
                    "key": "time",
                    "render": {
                      "children": [
                        {
                          "name": "Plaintext",
                          "properties": {
                            "textContent": "<%= CTX.__builtin_fn_mergeTexts({type:"expression",value:(moment(v * 1000).format("HH:mm:ss"))}) %>",
                          },
                        },
                      ],
                      "params": [
                        "v",
                      ],
                    },
                    "title": "时间",
                  },
                  {
                    "dataIndex": "opType",
                    "key": "opType",
                    "render": {
                      "children": [
                        {
                          "name": "Plaintext",
                          "properties": {
                            "textContent": "<%= CTX.__builtin_fn_mergeTexts({type:"expression",value:(\`\${v}\${r.opSubType ? \` / \${r.opSubType}\` : ""}\`)}) %>",
                          },
                        },
                      ],
                      "params": [
                        "v",
                        "r",
                      ],
                    },
                    "title": "操作类型",
                  },
                  {
                    "dataIndex": "data",
                    "key": "data",
                    "render": {
                      "children": [
                        {
                          "children": [
                            {
                              "children": undefined,
                              "componentId": undefined,
                              "events": undefined,
                              "name": "CodeBlock",
                              "properties": {
                                "language": "json",
                                "source": "<%= FN.prettierOutput(v) %>",
                                "style": {
                                  "maxWidth": "696px",
                                },
                              },
                              "ref": undefined,
                            },
                            {
                              "children": [
                                {
                                  "name": "Plaintext",
                                  "properties": {
                                    "textContent": "<%= v %>",
                                  },
                                },
                              ],
                              "componentId": undefined,
                              "events": undefined,
                              "name": "Plaintext",
                              "properties": {
                                "style": {
                                  "display": "block",
                                  "maxWidth": "696px",
                                  "overflow": "hidden",
                                  "textOverflow": "ellipsis",
                                  "whiteSpace": "nowrap",
                                },
                              },
                              "ref": undefined,
                              "slot": "else",
                            },
                          ],
                          "name": "If",
                          "properties": {
                            "dataSource": "<%= CTX.allExpanded || CTX.expandedSet.has(r.logId) %>",
                          },
                        },
                      ],
                      "params": [
                        "v",
                        "r",
                      ],
                    },
                    "title": "数据",
                  },
                  {
                    "dataIndex": "operation",
                    "key": "operation",
                    "render": {
                      "children": [
                        {
                          "children": undefined,
                          "componentId": undefined,
                          "events": {
                            "open.detail": [
                              {
                                "action": "update_variable",
                                "payload": {
                                  "name": "detailLog",
                                  "value": "<% r %>",
                                },
                              },
                              {
                                "action": "call_ref",
                                "payload": {
                                  "args": [],
                                  "method": "open",
                                  "ref": "modalRef",
                                  "scope": "view",
                                },
                              },
                            ],
                            "toggle": [
                              {
                                "action": "update_variable",
                                "payload": {
                                  "name": "expandedSet",
                                  "value": "<% new Set(
                        CTX.expandedSet.has(r.logId)
                          ? [...CTX.expandedSet].filter((id) => id !== r.logId)
                          : [...CTX.expandedSet, r.logId]
                      ) %>",
                                },
                              },
                            ],
                          },
                          "name": "Operations",
                          "properties": {
                            "allExpanded": "<%= CTX.allExpanded %>",
                            "expanded": "<%= CTX.expandedSet.has(r.logId) %>",
                          },
                          "ref": undefined,
                        },
                      ],
                      "params": [
                        "v",
                        "r",
                      ],
                    },
                    "title": "操作",
                  },
                ],
                "dataSource": {
                  "list": "<%= CTX.logs %>",
                },
                "pagination": false,
                "rowKey": "logId",
              },
              "ref": undefined,
            },
          ],
          "name": "If",
          "properties": {
            "dataSource": "<%= CTX.logs %>",
          },
        },
        {
          "children": [
            {
              "children": [
                {
                  "children": undefined,
                  "componentId": undefined,
                  "events": undefined,
                  "name": "Descriptions",
                  "properties": {
                    "columns": 1,
                    "dataSource": "<%= CTX.detailLog %>",
                    "list": [
                      {
                        "field": "logId",
                        "label": "日志 ID",
                      },
                      {
                        "field": "conversationId",
                        "label": "任务 ID",
                      },
                      {
                        "field": "taskId",
                        "label": "任务 ID",
                      },
                      {
                        "field": "time",
                        "label": "时间",
                        "render": {
                          "children": [
                            {
                              "name": "Plaintext",
                              "properties": {
                                "textContent": "<%= CTX.__builtin_fn_mergeTexts({type:"expression",value:(moment(r.time * 1000).format("llll"))}) %>",
                              },
                            },
                          ],
                          "params": [
                            "r",
                          ],
                        },
                      },
                    ],
                  },
                  "ref": undefined,
                },
                {
                  "children": undefined,
                  "componentId": undefined,
                  "events": undefined,
                  "name": "CodeBlock",
                  "properties": {
                    "language": "json",
                    "source": "<%= FN.prettierOutput(CTX.detailLog.data) %>",
                  },
                  "ref": undefined,
                },
              ],
              "name": "If",
              "properties": {
                "dataSource": "<%= CTX.detailLog %>",
              },
            },
          ],
          "componentId": undefined,
          "events": undefined,
          "name": "Modal",
          "properties": {
            "hideCancelButton": true,
            "maskClosable": true,
            "title": "<%= CTX.detailLog
            ? \`\${r.opType}\${r.opSubType ? \` / \${r.opSubType}\` : ""}\`
            : "" %>",
            "width": "800px",
          },
          "ref": "modalRef",
        },
      ],
      "componentId": undefined,
      "events": undefined,
      "name": "View",
      "properties": {
        "title": "任务日志",
      },
      "ref": undefined,
    },
  ],
  "componentsMap": Map {},
  "contextSetters": Map {
    "setLogId" => "logId",
    "setAllExpanded" => "allExpanded",
    "setExpandedSet" => "expandedSet",
    "setDetailLog" => "detailLog",
  },
  "contexts": [
    "logId",
    "allExpanded",
    "expandedSet",
    "detailLog",
    "logs",
  ],
  "contracts": Set {
    "<% \`logs/\${CTX.logId}\` %>",
  },
  "dataSources": [
    {
      "api": "<% \`logs/\${CTX.logId}\` %>",
      "config": {
        "enabled": "<% !!CTX.logId %>",
        "fallback": null,
      },
      "http": true,
      "name": "logs",
      "scope": "view",
      "transform": "<% DATA.data.logs %>",
    },
  ],
  "errors": [],
  "functionNames": [
    "prettierOutput",
  ],
  "functions": [
    {
      "name": "prettierOutput",
      "source": "function prettierOutput(output: string) {
  try {
    const data = JSON.parse(output);
    return JSON.stringify(data, null, 2);
  } catch (e) {
    return output;
  }
}",
      "typescript": true,
    },
  ],
  "globals": Map {
    "query" => "QUERY",
  },
  "refs": [
    "modalRef",
  ],
  "templates": [
    {
      "components": [
        {
          "children": [
            {
              "children": [
                {
                  "children": undefined,
                  "componentId": undefined,
                  "events": {
                    "click": [
                      {
                        "action": "dispatch_event",
                        "payload": {
                          "detail": "<% EVENT.detail %>",
                          "type": "toggle",
                        },
                      },
                    ],
                  },
                  "name": "Button",
                  "properties": {
                    "textContent": "<%= CTX.__builtin_fn_mergeTexts({type:"expression",value:(STATE.expanded ? "收起" : "展开")}) %>",
                  },
                  "ref": undefined,
                },
              ],
              "name": "If",
              "properties": {
                "dataSource": "<%= !STATE.allExpanded %>",
              },
            },
            {
              "children": undefined,
              "componentId": undefined,
              "events": {
                "click": [
                  {
                    "action": "dispatch_event",
                    "payload": {
                      "detail": "<% EVENT.detail %>",
                      "type": "open.detail",
                    },
                  },
                ],
              },
              "name": "Button",
              "properties": {
                "textContent": "详情",
              },
              "ref": undefined,
            },
          ],
          "componentId": undefined,
          "events": undefined,
          "name": "Toolbar",
          "properties": {},
          "ref": undefined,
        },
      ],
      "dataSources": [],
      "name": "Operations",
      "variables": [
        {
          "expose": true,
          "name": "expanded",
        },
        {
          "expose": true,
          "name": "allExpanded",
        },
      ],
    },
  ],
  "variables": [
    {
      "expose": false,
      "name": "logId",
      "value": "<% QUERY.logId %>",
    },
    {
      "expose": false,
      "name": "allExpanded",
      "value": false,
    },
    {
      "expose": false,
      "name": "expandedSet",
      "value": "<% new Set() %>",
    },
    {
      "expose": false,
      "name": "detailLog",
      "value": null,
    },
  ],
}
`;
